<?xml version="1.0" encoding="UTF-8" ?>
<project name="TurtleMod" basedir="." default="all">
	<property environment="env"/>
	<!-- Properties -->
	<property name="build.dir" value="build" />
	<property name="release.dir" value="release" />
	<property name="src.dir" value="common" />
	<property name="resource.dir" value="TurtleMod_resources" />
	
	<property name="mcp.dir" value="../../forge/1.6.2/mcp/" />
	<property name="mcpsrc.dir" value="${mcp.dir}/src" />
	
	<property name="mc.version" value="1.6.2"/>
	<property name="forge.version" value="7.8.0.703"/>
	<property name="project.version" value="Alpha 4.0"/>
	
	<property name="python" location="${mcp.dir}/runtime/bin/python/python_mcp.exe" />
	<!-- Targets -->
	
	<target name="Setup">
		<echo message="Copying sources to required locations" />
		<delete dir="${mcpsrc.dir}/minecraft" />
		<copy todir="${mcpsrc.dir}/minecraft" verbose="true">
			<fileset dir="${mcpsrc.dir}/clean/minecraft" />
			<fileset dir="${src.dir}" />
		</copy>
	</target>
	
	<target name="init" description="Initialize build environment">
		<echo message="Cleaning old build and dist, MCP reobf directories" />
		<delete dir="${build.dir}" />
		<delete dir="${release.dir}" />
		<delete dir="${mcp.dir}/reobf" />

		<echo message="Creating build and dist dirs" />
		<mkdir dir="${build.dir}" />
		<mkdir dir="${release.dir}" />
	</target>
	
	<target name="recompile" description="MCP recompile">
		<exec executable="${python}" dir="${mcp.dir}">
			<arg value="runtime/recompile.py" />
			<arg value="%*" />
		</exec>
	</target>
	
	<target name="reobfuscate" description="MCP reobfuscate">
		<exec executable="${python}" dir="${mcp.dir}">
			<arg value="runtime/reobfuscate.py" />
			<arg value="%*" />
		</exec>
	</target>
	
	<target name="stage" description="Stage resources into build directory">
		<copy todir="${build.dir}">
			<fileset dir="${mcp.dir}/reobf/minecraft" excludes=".svn/**, *.txt" />
			<fileset dir="${resource.dir}" excludes=".svn/**" />
			<fileset file="${src.dir}/mcmod.info" />
			<fileset file="${src.dir}/pack.mcmeta" />
		</copy>
	</target>
	
	<target name="all" description="Perform all tasks for a build" depends="Setup, init, recompile, reobfuscate, stage, jar">
		<echo message="MCP Ant Build Completed!" />
	</target>
	
	<target name="jar" description=".jar the project's dist output">
		<mkdir dir="${release.dir}" />
		<jar destfile="${release.dir}/TurtleMod.jar" duplicate="preserve" index="true" manifestencoding="UTF-8">
			<manifest>
				<attribute name="Implementation-Vendor" value="Ry_dog101/TheGeekyGuy101 and DeathJusty" />
				<attribute name="Implementation-Title" value="${ant.project.name}" />
				<attribute name="Implementation-Version" value="${project.version}" />
			</manifest>
			<fileset dir="${build.dir}" />
		</jar>
		<mkdir dir="${build.dir}/src" />
		<copy todir="${build.dir}/src">
			<fileset dir="${src.dir}" />
			<fileset dir="${resource.dir}" />
		</copy>
		<jar destfile="${release.dir}/TurtleMod-src.jar" duplicate="preserve" index="true" manifestencoding="UTF-8">
			<manifest>
				<attribute name="Implementation-Vendor" value="Ry_dog101/TheGeekyGuy101 and DeathJusty" />
				<attribute name="Implementation-Title" value="${ant.project.name}" />
				<attribute name="Implementation-Version" value="${project.version}" />
			</manifest>
			<fileset dir="${build.dir}/src" />
		</jar>
	</target>
	
</project>